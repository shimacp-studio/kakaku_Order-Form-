<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>シマコーポレーション 発注カタログ</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" href="img/shima_owl.jpg">
<meta name="color-scheme" content="light">
<style>
:root{
  --ink:#0f172a;--muted:#64748b;--line:#e5e7eb;--bg:#f6f8ff;--card:#fff;
  --brand:#1e66ff;--brand-ink:#fff;--accent:#155eef;--shadow:0 18px 45px rgba(15,23,42,.16);
}

/* ===== 全体 ===== */
*,
*::before,
*::after{box-sizing:border-box;margin:0;padding:0}

html,body{
  height:100%;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
  color:var(--ink);
  background:#e5ecff;
}

body{
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

/* リンク等 */
a{color:var(--brand);text-decoration:none}
button{
  font:inherit;
  cursor:pointer;
}

/* ===== TOPページコンテナ ===== */
#topPage{
  position:fixed;
  inset:0;
  z-index:40;
  background:radial-gradient(circle at top,#eff6ff 0,#e0ecff 40%,#c7d2fe 100%);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
  transition:opacity .5s ease,transform .5s ease;
}

#topPage.hidden{
  opacity:0;
  pointer-events:none;
  transform:translateY(-16px) scale(.98);
}

/* 透過カード */
.top-shell{
  width:100%;
  max-width:1120px;
  background:linear-gradient(135deg,rgba(255,255,255,.92),rgba(255,255,255,.88));
  border-radius:28px;
  box-shadow:0 24px 80px rgba(15,23,42,.28);
  padding:24px 26px 22px;
  display:flex;
  flex-direction:column;
  gap:16px;
  position:relative;
  overflow:hidden;
}

/* 背景の光彩 */
.top-shell::before{
  content:"";
  position:absolute;
  width:420px;height:420px;
  background:radial-gradient(circle at center,rgba(59,130,246,.18),rgba(59,130,246,0));
  top:-160px;right:-120px;
  opacity:.9;
  pointer-events:none;
  filter:blur(1px);
}

/* ===== 上部バー ===== */
.top-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
  padding-bottom:10px;
  border-bottom:15px solid #9ca3af;  
}

.top-brand{
  display:flex;
  align-items:center;
  gap:10px;
}

.top-logo{
  width:40px;
  height:40px;
  border-radius:999px;
  border:2px solid rgba(15,23,42,.05);
  box-shadow:0 10px 22px rgba(15,23,42,.35);
  object-fit:cover;
  background:#fff;
}

.top-brand-text{
  font-size:18px;
  font-weight:700;
  letter-spacing:.06em;
  color:#111827;
  text-shadow:0 1px 0 rgba(255,255,255,.9);
}

.top-ship{
  font-size:13px;
  font-weight:500;
  color:#374151;
  padding:6px 12px;
  border-radius:999px;
  background:rgba(15,23,42,.06);
  display:flex;
  align-items:center;
  gap:6px;
}

/* ===== ヒーロー行レイアウト ===== */
.top-hero-row{
  display:flex;
  align-items:stretch;
  gap:20px;
  margin-top:4px;
}

/* ヒーロー本体（左側） */
.top-hero{
  position:relative;
  flex:1.35;
  border-radius:22px;
  overflow:hidden;
  background:radial-gradient(circle at top,#eff6ff 0,#dbeafe 45%,#bfdbfe 100%);
  padding:20px 22px;
  display:flex;
  flex-direction:column;
  gap:16px;
  box-shadow:0 20px 60px rgba(15,23,42,.30);
}

/* シマフクロウ背景：右側に薄く配置 */
.top-hero::before{
  content:"";
  position:absolute;
  inset:-50px -110px -40px 40%;
  background:
    radial-gradient(circle at top,rgba(255,255,255,.9),rgba(255,255,255,0) 60%),
    url("img/shima_owl.jpg") right center/280px 280px no-repeat;
  mix-blend-mode:soft-light;
  opacity:.9;
  pointer-events:none;
  transform:translate3d(0,0,0);
}

/* 光と陰影をまとめた1枚のグラデーション（※この1つだけ有効） */
.top-hero::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(
    180deg,
    rgba(0,0,0,0.05) 0%,
    rgba(0,0,0,0.00) 40%,
    rgba(0,0,0,0.12) 100%
  );
  pointer-events:none;
  z-index:0;
}

.top-hero-inner{
  position:relative;
  z-index:1;
  display:flex;
  flex-direction:column;
  gap:18px;
}

/* 左側コピー */
.top-hero-copy{
  font-size:30px;
  line-height:1.4;
  font-weight:800;
  color:#0f172a;
  letter-spacing:.03em;
  text-shadow:0 2px 8px rgba(15,23,42,.35);
}

.top-hero-copy span{
  display:inline-block;
  padding:2px 10px;
  margin:0 -2px;
  border-radius:999px;
  background:rgba(255,255,255,.92);
  box-shadow:0 8px 18px rgba(15,23,42,.35);
}

/* サブコピー */
.top-hero-subline{
  font-size:13px;
  line-height:1.52;
  color:#111827;
  max-width:420px;
  padding:7px 12px;
  border-radius:999px;
  background:rgba(248,250,252,.85);
  border:1px solid rgba(148,163,184,.5);
  box-shadow:0 12px 28px rgba(15,23,42,.3);
}

/* 実績バッジ */
.top-hero-badges{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:2px;
}

.top-badge{
  font-size:11px;
  font-weight:600;
  color:#111827;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.96);
  border:1px solid rgba(148,163,184,.5);
  box-shadow:0 10px 22px rgba(15,23,42,.28);
}

/* ===== 右側フォーム ===== */
.top-form-shell{
  flex:0.95;
  display:flex;
  align-items:stretch;
}

.top-form{
  position:relative;
  flex:1;
  border-radius:20px;
  padding:18px 18px 16px;
  background:
    linear-gradient(145deg,#0f172a,#111827 22%,#1d4ed8 100%);
  color:#e5e7eb;
  box-shadow:0 18px 45px rgba(15,23,42,.6);
  overflow:hidden;
}

/* フォーム内の薄いグリッド背景 */
.top-form::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at top left,rgba(56,189,248,.2),transparent 60%),
    radial-gradient(circle at bottom right,rgba(59,130,246,.3),transparent 65%);
  opacity:.88;
  pointer-events:none;
}

.top-form::after{
  content:"";
  position:absolute;
  inset:12px;
  border-radius:16px;
  border:1px solid rgba(148,163,184,.5);
  box-shadow:0 0 0 1px rgba(15,23,42,.8) inset;
  pointer-events:none;
}

/* フォーム内レイアウト */
.top-form-inner{
  position:relative;
  z-index:1;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* フォームのタイトルと説明 */
.top-form-title{
  font-size:15px;
  font-weight:700;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:#e5e7eb;
}

.top-form-sub{
  font-size:11px;
  color:#cbd5f5;
}

/* ラベル＋入力 */
.top-field{
  display:flex;
  flex-direction:column;
  gap:4px;
}

.top-label{
  font-size:11px;
  font-weight:600;
  letter-spacing:.06em;
  text-transform:uppercase;
  color:#e5e7eb;
}

/* 入力欄 */
.top-input{
  width:100%;

  /* 1枚目: ロゴ / 2枚目: 淡い青グラデーション */
  background:
    url("img/shima_owl.jpg") 12px center / 20px 20px no-repeat,
    linear-gradient(120deg,#dbeafe 0%,#e0f2fe 40%,#bfdbfe 100%);

  border:0;
  border-radius:10px;
  padding:10px 14px;
  padding-left:44px;          /* ロゴぶん左の余白を広げる */
  font-size:14px;
  outline:none;
  box-shadow:none;

  color:#0f172a;
  box-shadow:0 0 0 1px rgba(15,23,42,.7),0 12px 25px rgba(15,23,42,.65);
  transition:box-shadow .18s ease,transform .18s ease,background .18s ease;
}

.top-input::placeholder{
  color:#6b7280;
}

.top-input:focus{
  outline:none;
  box-shadow:0 0 0 2px rgba(37,99,235,0.35);
}

.top-input:-webkit-autofill{
  -webkit-box-shadow:0 0 0 30px #eff4ff inset !important;
          box-shadow:0 0 0 30px #eff4ff inset !important;
  -webkit-text-fill-color:#0f172a !important;
}

/* ボタン */
.top-submit{
  margin-top:4px;
  padding:11px 12px;
  border-radius:999px;
  border:0;
  font-size:14px;
  font-weight:700;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:#e5efff;
  background:linear-gradient(120deg,#1d4ed8,#2563eb,#1e40af);
  box-shadow:0 14px 30px rgba(15,23,42,.8);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  transition:transform .12s ease,box-shadow .12s ease,filter .12s ease;
}

.top-submit span.icon{
  font-size:15px;
}

.top-submit:hover{
  filter:brightness(1.05);
  transform:translateY(-1px);
}

.top-submit:active{
  transform:translateY(1px) scale(.99);
  box-shadow:0 8px 20px rgba(15,23,42,.7);
}

/* 注記 */
.top-note{
  margin-top:4px;
  font-size:10px;
  line-height:1.4;
  color:#c7d2fe;
}

/* 下部の小さい説明やメモ */
.top-footer-row{
  margin-top:8px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  font-size:11px;
  color:#4b5563;
}

.top-footer-left{
  max-width:420px;
}

.top-footer-right{
  text-align:right;
  color:#111827;
}

.top-footer-right strong{
  font-weight:700;
}

/* ===== レスポンシブ: 幅が狭いとき ===== */
@media(max-width:880px){
  .top-shell{
    padding:18px 16px 16px;
  }
  .top-hero-row{
    flex-direction:column;
  }
  .top-hero{
    order:1;
  }
  .top-form-shell{
    order:0;
  }
}

/* ====== ここからカタログ画面のスタイル ====== */

.site-header{position:sticky;top:0;z-index:30;background:#ffffffcc;
border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(6px)}
.wrap{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
.brand{display:flex;align-items:center;gap:8px}
.brand img{width:32px;height:32px;border-radius:50%;box-shadow:0 4px 10px rgba(15,23,42,.2)}
.brand h1{font-size:18px;font-weight:700;color:#0f172a;letter-spacing:.06em}
.actions{display:flex;align-items:center;gap:10px}

/* カートトグルボタン */
.cart-toggle{
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.8);
  background:rgba(255,255,255,.95);
  box-shadow:0 6px 18px rgba(15,23,42,.25);
}
.cart-toggle img{
  width:18px;
  height:18px;
}

/* 印刷ボタン */
.print-btn{
  padding:7px 12px;
  border-radius:999px;
  border:0;
  background:linear-gradient(120deg,#1d4ed8,#2563eb);
  color:#f9fafb;
  font-size:12px;
  font-weight:600;
  letter-spacing:.05em;
  text-transform:uppercase;
  box-shadow:0 8px 22px rgba(37,99,235,.6);
}

/* メイン */
main{
  flex:1;
  display:none;
  background:radial-gradient(circle at top,#eef2ff 0,#e0e7ff 40%,#e5e7eb 100%);
}

/* 商品グリッド */
.grid{
  max-width:1200px;
  margin:0 auto;
  padding:20px 16px 32px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:16px;
  align-content:flex-start;
}

/* 商品カード */
.card{
  background:var(--card);
  border-radius:18px;
  box-shadow:0 12px 30px rgba(15,23,42,.25);
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:8px;
  position:relative;
  overflow:hidden;
}

/* バーコード用 */
.barcode{width:100%;height:40px}

/* カード内要素 */
.card-header{display:flex;gap:8px}
.card-img-wrap{width:82px;height:82px;border-radius:14px;overflow:hidden;background:#e5e7eb;flex-shrink:0}
.card-img-wrap img{width:100%;height:100%;object-fit:cover}
.card-body{flex:1;display:flex;flex-direction:column;gap:4px}
.card-title{font-size:13px;font-weight:600;color:#111827}
.card-jan{font-size:11px;color:#6b7280}
.card-price{font-size:14px;font-weight:700;color:#b91c1c}
.card-price span{font-size:11px;color:#6b7280;margin-left:4px}

/* 数量入力＋ボタン */
.card-footer{display:flex;align-items:center;gap:8px;margin-top:4px}
.card-footer input{
  width:64px;
  padding:6px 8px;
  border-radius:999px;
  border:1px solid var(--line);
  font-size:13px;
}
.card-footer button{
  flex:1;
  padding:6px 8px;
  border-radius:999px;
  border:0;
  background:linear-gradient(120deg,#16a34a,#22c55e);
  color:#ecfdf5;
  font-size:12px;
  font-weight:600;
  box-shadow:0 8px 20px rgba(22,163,74,.6);
}

/* カートパネル */
.cart{
  position:fixed;
  top:60px;right:10px;
  width:320px;
  max-height:70vh;
  background:#0f172a;
  color:#e5e7eb;
  border-radius:16px;
  box-shadow:0 22px 50px rgba(15,23,42,.7);
  padding:12px;
  display:none;
  flex-direction:column;
  gap:8px;
  z-index:50;
}
.cart.open{display:flex}
.cart h2{font-size:14px;margin-bottom:4px}
.cart-items{flex:1;overflow:auto;font-size:12px}
.cart-item{display:flex;justify-content:space-between;gap:4px;padding:4px 0;border-bottom:1px solid rgba(55,65,81,.6)}
.cart-summary{font-size:13px;font-weight:600;margin-top:4px}
.cart-actions{display:flex;gap:8px;margin-top:6px}
.cart-actions button{flex:1;padding:6px 8px;border-radius:999px;border:0;font-size:12px;font-weight:600}
.btn-clear{background:#1f2937;color:#e5e7eb}
.btn-send{background:#2563eb;color:#eff6ff}

/* 印刷用ヘッダ／フッタ */
.header-print,
.footer-print{display:none}

/* ===== 印刷スタイル ===== */
@media print{
  body{background:#fff}
  #topPage{display:none !important}
  header,.cart{display:none !important}
  main{display:block}
  .grid{
    grid-template-columns:repeat(2,1fr);
    gap:12px;
    padding:8px;
  }
  .card{
    border-radius:10px;
    box-shadow:none;
    border:1px solid #cbd5e1;
    page-break-inside:avoid;
  }
  .card-footer button,
  .card-footer input{display:none}
  .qty-print{
    display:block;
    margin-top:4px;
    font-size:12px;
  }
  .header-print,
  .footer-print{display:block}
}

/* 自動補完リスト */
.autolist{
  position:absolute;
  inset:auto 18px 74px 18px;
  background:#020617;
  border-radius:12px;
  padding:8px;
  display:none;
  flex-direction:column;
  gap:4px;
  font-size:11px;
  color:#e5e7eb;
  box-shadow:0 18px 40px rgba(15,23,42,.85);
}
.autolist div{
  padding:6px 8px;
  border-radius:8px;
  cursor:pointer;
}
.autolist div:hover{
  background:#e0edff;
}

/* クリックを無視させる保険 */
.top-hero::after { pointer-events:none !important; }
</style>
</head>
<body>

<!-- === TOPページ（Wix風ヒーロー） === -->
<div id="topPage">
  <div class="top-shell">
    <!-- 上部バー -->
    <header class="top-header">
      <div class="top-brand">
        <img src="img/shima_owl.jpg" alt="シマコーポレーション ロゴ" class="top-logo">
        <span class="top-brand-text">シマコーポレーション 発注カタログ</span>
      </div>
      <div class="top-ship">現場からカンタン Web 発注</div>
    </header>

   <!-- ヒーロー＋フォーム -->
<div class="top-hero-row">

  <!-- 左：キャッチコピー -->
  <div class="top-hero">
    <div class="top-hero-inner">
      <p class="top-hero-copy">
        必要な消耗品を、<br>
        <span>たのめーるやAmazonを利用するように</span><br>
        シマコーポレーションの在庫からカンタン発注。
      </p>

      <p class="top-hero-subline">
        「あの軍手、どこで頼んでたっけ？」── もう迷わなくて大丈夫です。
        店舗でよく出る消耗品を、現場からそのままWebで注文できるようにしました。
      </p>

      <div class="top-hero-badges">
        <div class="top-badge">✓ 11店舗共通の発注リスト</div>
        <div class="top-badge">✓ 名札に載っている「担当者名・現場名」で管理</div>
        <div class="top-badge">✓ 「たのめーる」に頼る前に、まずは社内在庫をチェック</div>
      </div>
    </div>
  </div>

  <!-- 右：入力フォーム -->
  <div class="top-form-shell">
    <div class="top-form">
      <div class="top-form-inner">

        <div class="top-field">
          <label class="top-label" for="buyerName">発注者名</label>
          <input id="buyerName" class="top-input" type="text" placeholder="例）田巻">
        </div>

        <div class="top-field">
          <label class="top-label" for="partnerName">パートナー企業</label>
          <input id="partnerName" class="top-input" type="text" placeholder="例）外注先・協力会社名など （任意）">
        </div>

        <div class="top-field">
          <label class="top-label" for="siteName">現場名・作業場所</label>
          <input id="siteName" class="top-input" type="text" placeholder="例）門真店・立体駐車場工事現場など">
        </div>

        <button id="startBtn" class="top-submit" type="button">
          <span class="icon">▶</span>
          <span>発注カタログを開く</span>
        </button>

        <p class="top-note">
          ※発注内容はメールで送信され、必要に応じて在庫・納期を調整させていただきます。<br>
          ※LINE連携も実装予定です（発注内容をそのままチャットに送信）。
        </p>
      </div>
    </div>
  </div>

</div>

<!-- 下部説明 -->
<div class="top-footer-row">
  <div class="top-footer-left">
    在庫はシマコーポレーション各店舗に分散しており、最寄り店舗からの出荷・店頭受取なども柔軟に対応いたします。
  </div>
  <div class="top-footer-right">
    <strong>シマコーポレーション 本部</strong><br>
    ご相談は本部アシスタントチームまで。
  </div>
</div>

  </div>
</div>

<!-- === 発注カタログ画面 === -->
<header class="site-header">
  <div class="wrap">
    <div class="brand">
      <img src="img/shima_owl.jpg" alt="logo">
      <h1>シマコーポレーション 発注カタログ</h1>
    </div>
    <div class="actions">
  <!-- ★ カートトグルボタン（KART.png） -->
  <button id="cartToggle" class="cart-toggle" type="button">
    <img src="img/KART.png" alt="カート">
    <span id="cartCount">(0)</span>
  </button>
      <button class="print-btn" type="button" onclick="window.print()">印刷（A4縦）</button>
    </div>
  </div>
</header>

<!-- ===== メイン（商品グリッド＋カート） ===== -->
<main>
  <div class="grid" id="grid"></div>

  <!-- カート -->
  <aside class="cart" id="cartPanel">
    <h2>発注内容</h2>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-summary">
      合計点数: <span id="cartTotalQty">0</span> 点
    </div>
    <div class="cart-actions">
      <button class="btn-clear" type="button" onclick="clearCart()">クリア</button>
      <button class="btn-send" type="button" onclick="sendOrder()">この内容で発注（メール送信）</button>
    </div>
  </aside>
</main>

<script>
const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbxGz8VCT8IkE_8nPOX7vVh-CMGkpOVPsnIhbO-FEViWKcP6KAapatDeusREagPta62kuA/exec";

let PRODUCTS = [];
let cart = [];

/* ===== TOP → カタログ切り替え ===== */
function startFlow(){
  const buyer   = document.getElementById("buyerName").value.trim();
  const partner = document.getElementById("partnerName").value.trim();
  const site    = document.getElementById("siteName").value.trim();

  if(!buyer){
    alert("発注者名を入力してください。");
    return;
  }

  sessionStorage.setItem("buyerName",buyer);
  sessionStorage.setItem("partnerName",partner);
  sessionStorage.setItem("siteName",site);

  const top = document.getElementById("topPage");
  top.classList.add("hidden");

  setTimeout(()=>{
    top.style.display="none";
    document.querySelector("main").style.display="block";
    boot();
  },450);
}

/* Enterキーでスタート */
["buyerName","partnerName","siteName"].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener("keydown",e=>{
    if(e.key==="Enter") startFlow();
  });
});

document.getElementById("startBtn").addEventListener("click",startFlow);

/* ===== products.json 読み込み＆描画 ===== */
async function boot(){
  try{
    const res = await fetch("products.json",{cache:"no-store"});
    if(!res.ok) throw new Error("商品データの読み込みに失敗しました");
    PRODUCTS = await res.json();
    renderProducts(PRODUCTS);
  }catch(e){
    console.error(e);
    document.getElementById("grid").innerHTML =
      "<p style='color:red'>商品データの読み込みに失敗しました。</p>";
  }
}

/* 商品カード描画 */
function renderProducts(list){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  list.forEach(p=>{
    const card = document.createElement("div");
    card.className = "card";

    const header = document.createElement("div");
    header.className = "card-header";

    const imgWrap = document.createElement("div");
    imgWrap.className = "card-img-wrap";

    const img = document.createElement("img");
    img.src = `img/${p.jan}.jpg`;
    img.onerror = ()=>{img.src="img/noimage.jpg";};
    imgWrap.appendChild(img);

    const body = document.createElement("div");
    body.className = "card-body";

    const title = document.createElement("div");
    title.className = "card-title";
    title.textContent = p.name;

    const jan = document.createElement("div");
    jan.className = "card-jan";
    jan.textContent = `JAN: ${p.jan}`;

    const price = document.createElement("div");
    price.className = "card-price";
    const taxIn  = Math.round(p.price * 1.1);
    price.innerHTML = `¥${p.price.toLocaleString()} <span>(税込 ¥${taxIn.toLocaleString()})</span>`;

    const barcode = document.createElement("div");
    barcode.className = "barcode";
    barcode.textContent = p.jan; // シンプル表示（本番で本格バーコードに差し替え可）

    body.appendChild(title);
    body.appendChild(jan);
    body.appendChild(price);
    body.appendChild(barcode);

    header.appendChild(imgWrap);
    header.appendChild(body);

    const footer = document.createElement("div");
    footer.className = "card-footer";

    const qtyInput = document.createElement("input");
    qtyInput.type="number";
    qtyInput.min="1";
    qtyInput.value="1";

    const btn = document.createElement("button");
    btn.textContent = "カートに追加";
    btn.addEventListener("click",()=>{
      const q = Number(qtyInput.value)||0;
      if(q<=0) return;
      addToCart(p,q);
      qtyInput.value = 1;
    });

    footer.appendChild(qtyInput);
    footer.appendChild(btn);

    // 印刷用の数量表示（手書き欄）
    const qtyPrint = document.createElement("div");
    qtyPrint.className = "qty-print";
    qtyPrint.textContent = "数量：__________";

    card.appendChild(header);
    card.appendChild(footer);
    card.appendChild(qtyPrint);

    grid.appendChild(card);
  });
}

/* ===== カート処理 ===== */
function addToCart(product,qty){
  const idx = cart.findIndex(c=>c.jan===product.jan);
  if(idx>=0){
    cart[idx].qty += qty;
  }else{
    cart.push({
      jan:product.jan,
      name:product.name,
      price:product.price,
      qty:qty
    });
  }
  updateCart();
}

function updateCart(){
  const itemsEl = document.getElementById("cartItems");
  const totalQtyEl = document.getElementById("cartTotalQty");
  const countEl = document.getElementById("cartCount");

  itemsEl.innerHTML = "";
  let totalQty = 0;

  cart.forEach(c=>{
    totalQty += c.qty;
    const row = document.createElement("div");
    row.className = "cart-item";
    row.innerHTML = `
      <div>
        <div>${c.name}</div>
        <div style="font-size:10px;color:#9ca3af">JAN: ${c.jan}</div>
      </div>
      <div>×${c.qty}</div>
    `;
    itemsEl.appendChild(row);
  });

  totalQtyEl.textContent = totalQty;
  countEl.textContent = `(${totalQty})`;
}

function clearCart(){
  if(!cart.length) return;
  if(!confirm("カートを空にしますか？")) return;
  cart = [];
  updateCart();
}

/* カート開閉 */
document.getElementById("cartToggle").addEventListener("click",()=>{
  const panel = document.getElementById("cartPanel");
  if(!cart.length){
    alert("カートが空です。商品を追加してください。");
    return;
  }
  panel.classList.toggle("open");
});

/* ===== 発注内容送信 ===== */
async function sendOrder(){
  if(!cart.length){
    alert("カートが空です。商品を追加してください。");
    return;
  }

  const buyer   = sessionStorage.getItem("buyerName") || "";
  const partner = sessionStorage.getItem("partnerName") || "";
  const site    = sessionStorage.getItem("siteName") || "";

  const payload = {
    buyerName:buyer,
    partnerName:partner,
    siteName:site,
    items:cart
  };

  try{
    await fetch(GAS_ENDPOINT,{
      method:"POST",
      mode:"no-cors",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    alert("発注内容を送信しました。ありがとうございます！");
    cart = [];
    updateCart();

    document.getElementById("cartPanel").classList.remove("open");

    document.getElementById("topPage").style.display="flex";
    document.getElementById("topPage").classList.remove("hidden");
    document.querySelector("main").style.display="none";

    document.getElementById("buyerName").value = "";
    document.getElementById("partnerName").value = "";
    document.getElementById("siteName").value = "";

  }catch(e){
    console.error(e);
    alert("送信中にエラーが発生しました。時間をおいて再度お試しください。");
  }
}
</script>
</body>
</html>
