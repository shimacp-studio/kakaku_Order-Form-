<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>シマコーポレーション 発注カタログ</title>
<style>
:root {
  --ink:#0f172a;--muted:#64748b;--line:#e5e7eb;
  --bg:#f6f8ff;--card:#fff;--brand:#1e66ff;
  --accent:#155eef;--shadow:0 4px 16px rgba(16,24,40,.06);
}
*{box-sizing:border-box}
html,body{
  margin:0;background:var(--bg);color:var(--ink);
  font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif
}
h1{margin:0;font-weight:800}

/* === TOPページ（Wix風・1枚のヒーローカード） === */
#topPage{
  position:fixed;
  inset:0;
  z-index:9999;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  height:100dvh;
  width:100%;
  background:#f3f4f6;
 /* ▼ グレーの縁を太くする（上下左右とも少し広げる） */
  padding:24px 0px;
  box-sizing:border-box;
  transition:opacity .4s ease;
  opacity:1;
}

/* 白い大きなカード（1枚だけ） */
.top-shell{
  width:100%;
  max-width:1200px;
  margin:0 auto;
  background:#ffffff;
  border-radius:28px;
  box-shadow:0 18px 45px rgba(15,23,42,.20);
  padding:20px 32px 32px;
  display:flex;
  flex-direction:column;
  gap:20px;
}

/* 上のバー（ロゴ＋タイトル） */
.top-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
  padding-bottom:10px;
  border-bottom:15px solid #9ca3af;  
}
.top-brand{
  display:flex;
  align-items:center;
  gap:10px;
}
.top-logo{
  width:40px;
  height:40px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(15,23,42,.25);
  object-fit:cover;
}
.top-brand-text{
  font-weight:800;
  letter-spacing:.08em;
  font-size:14px;
  color:#111827;
}
.top-ship{
  font-size:12px;
  color:#6b7280;
}

/* 下側：ヒーロー（背景＋左コピー＋右フォーム） */
.top-hero-row{
  position:relative;
  margin-top:16px;
}

/* ヒーロー全体：淡い青グラデだけにする */
.top-hero{
  position:relative;
  width:100%;
  height:420px;
  border-radius:22px;
  overflow:hidden;
  /* ★ ロゴは消して、背景は淡い青グラデだけ */
  background:linear-gradient(115deg,#dbeafe 0%,#e5f0ff 40%,#c7ddff 100%);
}

/* ロゴ層：少し小さく＆薄く */
.top-hero::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    url("img/shima_owl.jpg") left center / 65% auto no-repeat;
    /* ↑ 65% を 50〜80% くらいで調整するとサイズ変えられます */
  opacity:0.25;           /* ★ 薄さ：0.25 ぐらい。もっと薄くしたければ 0.15 とかに */
  pointer-events:none;
  z-index:0;
}

/* コピーとフォームは前面に */
.top-hero-copy,
.top-card{
  position:relative;
  z-index:1;
}



/* 小さいコメント用（任意） */
.top-hero-sub{
  font-size:14px;
  font-weight:500;
  opacity:.8;
}




/* 軽く縦のグラデで奥行きを出す */
.top-hero::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(
    180deg,
    rgba(0,0,0,0.05) 0%,
    rgba(0,0,0,0.00) 40%,
    rgba(0,0,0,0.12) 100%
  );
  pointer-events:none;
  z-index:0;
}

/* 左側キャッチコピー（大きな黒文字） */
.top-hero-copy{
  position:absolute;
  left:56px;
  top:50%;
  transform:translateY(-50%);
  max-width:520px;
  font-size:32px;
  line-height:1.5;
  color:#111827;
  font-weight:800;
  z-index:1;
}

.top-card{
  position:absolute;
  right:56px;
  top:50%;
  transform:translateY(-50%);
  width:320px;
  max-width:38%;
  padding:22px 22px 24px;

  /* ★ ここを変更（白パネルをやめる） */
  background:transparent;        /* ← 白い背景をやめる */
  box-shadow:none;               /* ← 影も消す */
  border-radius:0;               /* ← 角丸も不要なら 0 に */

  text-align:left;
  z-index:1;
}

.top-eyebrow{
  font-size:11px;
  letter-spacing:.18em;
  font-weight:700;
  color:#9ca3af;
  margin:0 0 6px;
}
.top-card h1{
  font-size:18px;
  line-height:1.6;
  font-weight:800;
  color:#111827;
  margin:0 0 8px;
}
.top-lead{
  margin:0 0 14px;
  font-size:13px;
  color:#6b7280;
}

/* 入力フォーム（縦並び） */
.top-form{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.autowrap{
  position:relative;
  width:100%;
}

/* TOPページ専用の入力ボックス（ロゴ＋淡い青グラデ） */
.top-input{
  width:100%;

  /* 1枚目: ロゴ / 2枚目: 淡い青グラデーション */
  background:
    url("img/shima_owl.jpg") 12px center / 20px 20px no-repeat,
    linear-gradient(120deg,#dbeafe 0%,#e0f2fe 40%,#bfdbfe 100%);

  border:0;
  border-radius:10px;
  padding:10px 14px;
  padding-left:44px;          /* ロゴぶん左の余白を広げる */
  font-size:14px;
  outline:none;
  box-shadow:none;
  -webkit-appearance:none;
  appearance:none;
}

.top-input:focus{
  outline:none;
  box-shadow:0 0 0 2px rgba(37,99,235,0.35);
}
.top-card input{
  border:0 !important;
  outline:none !important;
  box-shadow:none !important;
}
.top-input:-webkit-autofill{
  -webkit-box-shadow:0 0 0 30px #f3f4ff inset !important;
          box-shadow:0 0 0 30px #f3f4ff inset !important;
  -webkit-text-fill-color:#0f172a !important;
}

/* 開くボタン（Wix っぽい青） */
.top-start-btn{
  margin-top:8px;
  width:100%;
  background:linear-gradient(135deg,#2563eb,#1d4ed8);
  border-color:#1d4ed8;
  font-size:14px;
  padding:11px 18px;
}
.top-start-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 8px 18px rgba(37,99,235,.35);
}

/* スマホ・タブレットでは縦積み */
@media (max-width:900px){
  #topPage{
    align-items:flex-start;
    padding:8px 0;
  }
  .top-shell{
    margin:0 12px;
    padding:16px 14px 18px;
    border-radius:20px;
  }
  .top-hero{
    height:auto;
    padding:32px 18px 18px;
    border-radius:18px;
  }
  .top-hero::before{
    background-position:center bottom;
    background-size:auto 70%;
    opacity:0.6;
  }
  .top-hero-copy{
    position:static;
    transform:none;
    margin-bottom:18px;
    font-size:22px;
    max-width:none;
  }
  .top-card{
    position:static;
    transform:none;
    width:100%;
    max-width:none;
    margin-top:8px;
  }
}



/* === カタログ画面 === */
header:not(.top-header){position:sticky;top:0;z-index:30;background:#ffffffcc;
border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(6px)}
.wrap{max-width:1200px;margin:0 auto;padding:10px 16px;
display:flex;justify-content:space-between;align-items:center;gap:10px;}
.brand{display:flex;align-items:center;gap:10px;}
.brand img{height:38px;width:auto}
.actions{display:flex;gap:12px;align-items:center}
.btn{background:var(--brand);color:#fff;border:1px solid #1243c1;
border-radius:10px;padding:8px 14px;font-weight:700;cursor:pointer;font-size:13px;transition:0.3s}
.btn:disabled{opacity:.5;cursor:not-allowed}
.controls{max-width:1200px;margin:10px auto;display:grid;gap:8px;
padding:0 16px;grid-template-columns:repeat(3,1fr);}

/* TOPページ専用の入力ボックス */
.top-input{
  width:100%;
  /* ★ 背景色 ＋ ロゴ画像をまとめて指定 */
  background:
    #eff4ff
    url("img/shima_owl.jpg") no-repeat 12px center;
  background-size:20px 20px;   /* ロゴの大きさ */

  border:0;                    /* 枠線・下線を完全に消す */
  border-radius:10px;
  padding:10px 14px;
  padding-left:44px;           /* ★ ロゴ分だけ左の余白を広げる */
  font-size:14px;
  outline:none;
  box-shadow:none;
  -webkit-appearance:none;
  appearance:none;
}


/* 念のため：TOPのカード内 input には一切線を出さない */
.top-card input{
  border:0 !important;
  outline:none !important;
  box-shadow:none !important;
}

/* フォーカス時だけふんわり青い枠を出す */
.top-input:focus{
  outline:none;
  box-shadow:0 0 0 2px rgba(37,99,235,0.35);
}

/* オートフィル時も同じ薄いブルーにする（Chrome対策） */
.top-input:-webkit-autofill{
  -webkit-box-shadow:0 0 0 30px #eff4ff inset !important;
          box-shadow:0 0 0 30px #eff4ff inset !important;
  -webkit-text-fill-color:#0f172a !important;
}

/* === カタログ画面 === */

/* 発注画面ヘッダー（ロゴ＋KART＋印刷ボタン） */
header:not(.top-header){
  position:sticky;
  top:0;
  z-index:30;
  background:rgba(255,255,255,.97);
  border-bottom:1px solid #e5e7eb;
  backdrop-filter:saturate(140%) blur(10px);
  box-shadow:0 8px 24px rgba(15,23,42,.04);
}

.wrap{
  max-width:1120px;
  margin:0 auto;
  padding:10px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
}
.brand img{
  height:30px;
  width:30px;
  border-radius:10px;
  box-shadow:0 6px 14px rgba(15,23,42,.18);
}
.brand h1{
  font-size:13px;
  letter-spacing:.16em;
  text-transform:uppercase;
  font-weight:700;
  color:#111827;
}

/* 右側：KART＋印刷ボタン */
.actions{
  display:flex;
  gap:10px;
  align-items:center;
}

/* 共通ボタン（印刷ボタン・カート内ボタンなど） */
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:7px 14px;
  border-radius:999px;
  border:1px solid #c4d0ea;
  background:#111827;
  color:#f9fafb;
  font-size:12px;
  font-weight:600;
  letter-spacing:.08em;
  text-transform:uppercase;
  cursor:pointer;
  box-shadow:0 10px 24px rgba(15,23,42,.35);
  transition:
    transform .15s ease,
    box-shadow .15s ease,
    background .15s ease,
    border-color .15s ease;
}
.btn:hover{
  transform:translateY(-1px);
  box-shadow:0 14px 28px rgba(15,23,42,.45);
}
.btn:disabled{
  opacity:.5;
  cursor:not-allowed;
  box-shadow:none;
  transform:none;
}

/* === 発注カタログ画面レイアウト === */
main{
  display:none; /* JS で表示制御 */
  max-width:1120px;
  margin:26px auto 40px;
  padding:0 20px 40px;
}

/* 商品グリッド */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:18px 16px;
}

/* 1商品カード：極力ミニマルな白カード */
.card{
  position:relative;
  display:flex;
  flex-direction:column;
  border-radius:18px;
  background:#ffffff;
  border:1px solid #e5e7eb;
  box-shadow:0 8px 20px rgba(15,23,42,.03);
  overflow:hidden;
  transition:
    transform .16s ease,
    box-shadow .16s ease,
    border-color .16s ease,
    background .16s ease;
}
.card:hover{
  transform:translateY(-2px);
  box-shadow:0 16px 32px rgba(15,23,42,.08);
  border-color:#c7d2fe;
}

/* 画像エリア：明るいグラデ＋中央寄せ */
.thumb{
  width:100%;
  aspect-ratio:4/3;
  background:radial-gradient(circle at top,#eff6ff 0,#e5f0ff 50%,#dee9ff 100%);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.thumb img{
  width:88%;
  max-height:88%;
  object-fit:contain;
  display:block;
}

/* テキストエリア */
.body{
  padding:10px 14px 12px;
  display:flex;
  flex-direction:column;
  gap:4px;
  flex:1;
}

/* 商品名 */
.title{
  font-size:13px;
  font-weight:700;
  line-height:1.5;
  color:#111827;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
  min-height:3em; /* 2行ぶん高さをそろえる */
}

/* 価格行：税込を太字で、税抜はグレーで控えめに */
.price-row{
  margin-top:4px;
  display:flex;
  align-items:baseline;
  gap:6px;
}
.price-main{
  font-size:16px;
  font-weight:800;
  color:#b91c1c;
}
.price-sub{
  font-size:11px;
  color:#6b7280;
}

/* 互換用（印刷CSSなどが .price を参照している可能性があるので残す） */
.price{
  font-size:13px;
  font-weight:700;
  color:#111827;
}

/* バーコード */
.barcode{
  margin-top:6px;
}
.barcode svg{
  height:20px;
  width:90px;
}

/* 下部：数量入力＋カートボタン */
.actions-card{
  display:flex;
  align-items:center;
  gap:8px;
  padding:9px 12px 10px;
  border-top:1px solid #e5e7eb;
  background:#f9fafb;
}

.qtyinput{
  flex:0 0 76px;
  padding:6px 8px;
  border-radius:999px;
  border:1px solid #d1d5db;
  font-size:13px;
  text-align:center;
  background:#ffffff;
}

/* カード内「カートに追加」ボタン */
.actions-card .btn{
  flex:1;
  font-size:12px;
  padding:7px 10px;
  box-shadow:none;
  background:#111827;
  border-color:#111827;
}
.actions-card .btn:hover{
  box-shadow:0 10px 24px rgba(15,23,42,.35);
}

/* === カート（右側ドロワー） === */
.cart{
  position:fixed;
  top:82px;
  right:24px;
  width:320px;
  max-height:calc(100dvh - 120px);

  display:flex;
  flex-direction:column;
  gap:10px;
  padding:14px 16px 14px;

  background:#ffffff;
  border-radius:18px;
  border:1px solid #e5e7eb;
  box-shadow:0 18px 40px rgba(15,23,42,.18);
  color:#111827;
  z-index:60;

  /* 初期状態は画面外 */
  transform:translateX(110%);
  opacity:0;
  pointer-events:none;
  transition:transform .25s ease, opacity .25s ease;
}
.cart.open{
  transform:translateX(0);
  opacity:1;
  pointer-events:auto;
}

.cart h2{
  margin:0 0 4px;
  font-size:13px;
  letter-spacing:.12em;
  text-transform:uppercase;
  color:#6b7280;
}

/* カートの中身リスト */
.cartlist{
  flex:1;
  overflow:auto;
  padding-right:2px;
  font-size:12px;
}
.cartitem{
  display:grid;
  grid-template-columns:1fr auto auto auto;
  align-items:center;
  gap:6px;
  padding:6px 0;
  border-bottom:1px solid #e5e7eb;
}
.cartitem:last-child{
  border-bottom:none;
}
.cartitem div:nth-child(1){
  font-weight:500;
}
.cartitem div:nth-child(2),
.cartitem div:nth-child(3){
  text-align:right;
  font-variant-numeric:tabular-nums;
  color:#4b5563;
}

/* カート内の合計金額表示はデフォルトのままでも見やすいのでCSS最小限に */
.cart strong{
  font-weight:700;
}

/* カートの送信ボタン */
.cart .btn{
  margin-top:6px;
  width:100%;
  justify-content:center;
}

/* === ヘッダー右上の KART ボタン === */
.cart-toggle{
  position:relative;
  border:none;
  background:transparent;
  padding:0;
  cursor:pointer;
}
.cart-toggle img{
  display:block;
  height:28px;
  width:28px;
}

/* 件数バッジ */
.cart-badge{
  position:absolute;
  top:-4px;
  right:-4px;
  min-width:18px;
  padding:0 5px;
  height:18px;
  border-radius:999px;
  background:#ef4444;
  color:#fff;
  font-size:11px;
  font-weight:700;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 0 2px #f9fafb;
}
.cart-badge.is-empty{
  display:none;
}

/* レスポンシブ：狭い画面では margin/padding だけ調整 */
@media (max-width:960px){
  main{
    margin:18px auto 28px;
    padding:0 16px 32px;
  }
  .cart{
    width:100%;
    max-width:320px;
    right:12px;
    top:74px;
  }
}




/* === 印刷設定（前回の安定版をそのまま保持） === */
@page {
  size: A4 portrait;
  margin: 8mm 8mm 18mm 8mm;
}

/* 画面表示のときはヘッダー／フッターを隠す */
.header-print,
.footer-print{
  display:none;
}

@media print {
  /* 画面専用UIは印刷で隠す */
  #topPage, header, .actions, .cart, .actions-card, .controls {
    display:none!important;
  }

  /* 印刷時のみヘッダー／フッターを出す */
  .header-print{ display:flex !important; }
  .footer-print{ display:block !important; }

  /* 印刷時のベース */
  body {
    background:#fff!important;
    counter-reset:item;
    position:relative!important;
  }
  main {
    display:block!important;
    margin:0;
    padding:0;
    position:relative!important;
    min-height:245mm!important;
  }
  .grid {
    grid-template-columns:repeat(2,1fr)!important;
    gap:6mm;
    width:calc(210mm - 20mm);
    margin:30mm auto 0;
  }
  .card {
    position:relative;
    flex-direction:row;
    align-items:flex-start;
    gap:4mm;
    border:1px solid #d9e1f2;
    box-shadow:none;
    padding:3.5mm;
    height:calc((297mm - 95mm)/5);
    page-break-inside:avoid;
    background:#fff;
    border-radius:8px;
    overflow:hidden;
  }
  .card::before {
    counter-increment:item;
    content:"No." counter(item);
    position:absolute;
    bottom:1.8mm;
    right:2.2mm;
    padding:1.4mm 3mm;
    font-family:"Orbitron","Segoe UI","Noto Sans JP",sans-serif;
    font-weight:700;
    font-size:7.3pt;
    color:#fff;
    background:linear-gradient(135deg,#0ea5e9 0%,#2563eb 50%,#1e3a8a 100%);
    border-radius:12px;
  }
  .thumb {
    flex:0 0 33mm;
    height:auto;
    display:flex;
    align-items:center;
    justify-content:center;
    border:none;
  }
  .thumb img {
    max-height:27mm;
    max-width:100%;
    object-fit:contain;
  }
  .body {
    flex:1;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    gap:2mm;
    padding-right:3mm;
  }
  .title {
    font-size:9.3pt!important;
    line-height:1.4!important;
    max-height:22mm!important;
    overflow:hidden!important;
    white-space:normal!important;
    word-break:break-word!important;
    font-weight:700!important;
  }
  .barcode svg {height:20px;width:70px;}
  .price {font-size:9.3pt;}

  /* ★ 印刷専用「数量」欄（ここで表示ON） */
  .qty-print,
  .print-only{
    display:flex !important;
  }
  .qty-print {
    position:absolute!important;
    bottom:3mm!important;
    left:4mm!important;
    align-items:center;
    gap:1.2mm;
    font-size:9pt;
    font-weight:600;
  }
  .qty-print input {
    width:20mm!important;
    height:6mm!important;
    border:1px solid #bbb;
    border-radius:3mm;
    padding:0 2mm;
    background:#fff;
    outline:none;
  }

  /* 印刷ヘッダー／フッターの見た目 */
  .header-print {
    position:fixed;top:5mm;left:0;width:100%;
    display:flex;align-items:center;justify-content:center;gap:8px;background:#fff;
  }
  .header-print img{height:14mm;width:auto;}
  .header-print h2{font-size:16pt;font-weight:800;margin:0;}
  .footer-print {
    position:fixed!important;bottom:0mm!important;left:0;width:100%;
    text-align:center;font-size:11pt;
    font-family:"Noto Sans JP","Segoe UI",sans-serif;color:#0f172a;
    padding-top:2mm;background:#fff;z-index:9999;
  }
}


/* === オートコンプリート候補の見た目（TOPページ用） === */
.autolist {
  position:absolute;
  left:0;
  top:100%;
  margin-top:4px;
  width:100%;
  background:#ffffff;
  border:none;
  border-radius:8px;
  box-shadow:0 8px 16px rgba(15,23,42,0.12);
  max-height:180px;
  overflow-y:auto;
  font-size:14px;
  z-index:50;
}
.autolist:empty {        
 border: 0;        
 }  
.autolist div {
  padding:6px 10px;
  cursor:pointer;
}
.autolist div:hover {
  background:#e0edff;
}
</style>
</head>
<body>

<!-- === TOPページ（Wix風ヒーロー） === -->
<div id="topPage">
  <div class="top-shell">
    <!-- 上部バー -->
    <header class="top-header">
      <div class="top-brand">
        <img src="img/shima_owl.jpg" alt="シマコーポレーション ロゴ" class="top-logo">
        <span class="top-brand-text">シマコーポレーション 発注カタログ</span>
      </div>
      <div class="top-ship">現場からカンタン Web 発注</div>
    </header>

   <!-- ヒーロー＋フォーム -->
<div class="top-hero-row">
  <div class="top-hero">
    <!-- 左側コピー -->
    <p class="top-hero-copy">
      必要な消耗品を、<br>
      いつもの現場からまとめて注文。<br>
      <span class="top-hero-sub">
        スマホひとつで、発注漏れゼロへ。
      </span>
    </p>


        <!-- 右側フォームカード -->
        <div class="top-card">
          <p class="top-eyebrow">ORDER FORM</p>
          <h1>発注情報を入力して<br>カタログを開いてください</h1>
          <p class="top-lead">
            一度入力すると、次回から履歴として自動候補に表示されます。
          </p>

          <div class="top-form">
            <div class="autowrap">
              <input id="buyerName"   class="top-input" placeholder="発注者名"       autocomplete="off">
            </div>
            <div class="autowrap">
              <input id="partnerName" class="top-input" placeholder="パートナー企業" autocomplete="off">
            </div>
            <div class="autowrap">
              <input id="siteName"    class="top-input" placeholder="現場名"         autocomplete="off">
            </div>
            <button id="startBtn" class="btn top-start-btn">
              発注カタログを開く
            </button>
          </div>
        </div><!-- /.top-card -->
      </div><!-- /.top-hero -->
    </div><!-- /.top-hero-row -->
  </div><!-- /.top-shell -->
</div><!-- /#topPage -->




<!-- === 発注カタログ画面 === -->
<header>
  <div class="wrap">
    <div class="brand">
      <img src="img/shima_owl.jpg" alt="logo">
      <h1>シマコーポレーション 発注カタログ</h1>
    </div>
    <div class="actions">
  <!-- ★ カートトグルボタン（KART.png） -->
  <button id="cartToggle" class="cart-toggle" type="button">
    <img src="img/KART.png" alt="カート">
    <span id="cartBadge" class="cart-badge is-empty">0</span>
  </button>

  <!-- 既存の印刷ボタンはそのまま -->
  <button class="btn" onclick="window.print()">印刷（A4縦）</button>
</div>

  </div>
</header>

<main>
  <section><div id="grid" class="grid"></div></section>
  <aside class="cart">
    <h2>カート</h2>
    <div id="cartlist" class="cartlist"></div>
    <div><strong>小計：</strong><span id="subtotal">0円</span><br>
      <strong>税込：</strong><span id="total">0円</span></div>
    <button id="orderBtn" class="btn">この内容で発注（メール送信）</button>
  </aside>
</main>

<div class="header-print">
  <img src="img/shima_owl.jpg" alt="logo">
  <h2>シマコーポレーション 発注カタログ</h2>
</div>
<div class="footer-print">
  発注者名：＿＿＿＿＿＿＿＿＿＿＿　日付：＿＿＿＿＿＿＿＿＿＿＿　備考：＿＿＿＿＿＿＿＿＿＿＿
</div>

<script>
// === オートコンプリート機能（履歴のみ） ===
function enableAutoComplete(inputId){
  const input = document.getElementById(inputId);
  const list = document.createElement("div");
  list.className = "autolist";
  input.parentNode.appendChild(list);

  const saved = JSON.parse(localStorage.getItem(`history_${inputId}`) || "[]");

  input.addEventListener("input", () => { showList(input, list, saved); });
  input.addEventListener("focus", () => { showList(input, list, saved); });

  input.addEventListener("change", () => {
    const val = input.value.trim();
    if (!val) return;
    if (!saved.includes(val)) {
      saved.unshift(val);
      if (saved.length > 20) saved.pop();
      localStorage.setItem(`history_${inputId}`, JSON.stringify(saved));
    }
  });

  document.addEventListener("click", e => {
    if (!list.contains(e.target) && e.target !== input) list.innerHTML = "";
  });
}

function showList(input, list, saved) {
  const val = input.value.trim();
  list.innerHTML = "";
  const matches = val ? saved.filter(v => v.includes(val)) : saved;
  matches.forEach(m => {
    const item = document.createElement("div");
    item.textContent = m;
    item.onclick = () => {
      input.value = m;
      list.innerHTML = "";
    };
    list.appendChild(item);
  });
}

console.log("✅ script loaded");

const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbxGz8VCT8IkE_8nPOX7vVh-CMGkpOVPsnIhbO-FEViWKcP6KAapatDeusREagPta62kuA/exec";

let cart = [];

/* ====== 画面遷移のコア ====== */
function startFlow(){
  const buyer = (document.getElementById("buyerName")?.value || "").trim();
  if (!buyer){
    alert("発注者名を入力してください。");
    return;
  }
  sessionStorage.setItem("buyerName",   buyer);
  sessionStorage.setItem("partnerName", (document.getElementById("partnerName")?.value || "").trim());
  sessionStorage.setItem("siteName",    (document.getElementById("siteName")?.value || "").trim());

  const topPage = document.getElementById("topPage");
  const mainEl  = document.querySelector("main");

  if (topPage){
    topPage.style.opacity = "0";
    topPage.style.pointerEvents = "none";
    setTimeout(() => {
      topPage.style.display = "none";
      topPage.style.visibility = "hidden";
      topPage.style.zIndex = "-1";
    }, 350);
  }
  if (mainEl){
    mainEl.style.display   = "grid";
    mainEl.style.visibility= "visible";
    mainEl.style.opacity   = "1";
    mainEl.style.position  = "relative";
    mainEl.style.zIndex    = "10";
  }
  try { boot(); }
  catch(e){ console.error("boot() error:", e); alert("商品描画でエラーが発生しました。コンソールをご確認ください。"); }
}

function bindStartButton(){
  const btn = document.getElementById("startBtn");
  if (btn) btn.addEventListener("click", startFlow);
  // Enterでも開始
  ["buyerName","partnerName","siteName"].forEach(id=>{
    const el = document.getElementById(id);
    if (el) el.addEventListener("keydown", ev => { if (ev.key === "Enter") startFlow(); });
  });
}

// 念のため、クリック委任で拾う保険
document.addEventListener("click", ev=>{
  const hit = ev.target.closest?.("#startBtn");
  if (hit) startFlow();
});

// ヒーロー疑似要素がクリックをブロックしないよう強制
(function(){
  const style = document.createElement("style");
  style.textContent = `
    .top-hero::before, .top-hero::after { pointer-events:none !important; }
    .top-hero, .top-card, .top-form, .top-input, #startBtn { pointer-events:auto !important; }
  `;
  document.head.appendChild(style);
})();

/* ====== 起動時セットアップ ====== */
window.addEventListener("DOMContentLoaded", () => {
  console.log("✅ DOM Ready");

  // 入力欄を毎回リセット
  ["buyerName","partnerName","siteName"].forEach(id=>{
    const el = document.getElementById(id);
    if (el) el.value = "";
  });

  // オートコンプリート
  ["buyerName","partnerName","siteName"].forEach(id=>{
    try { enableAutoComplete(id); } catch(_) {}
  });

  // スタートボタン/Enter バインド
  bindStartButton();

  // メール送信ボタン
  const orderBtn = document.getElementById("orderBtn");
  if (orderBtn) orderBtn.onclick = sendOrder;

  // カートトグル
  const cartToggle = document.getElementById("cartToggle");
  const cartPanel  = document.querySelector(".cart");
  if (cartToggle && cartPanel){
    cartToggle.addEventListener("click", () => {
      if (!cart.length){ alert("カートに商品がありません"); return; }
      cartPanel.classList.toggle("open");
    });
  }
});

/* ====== カート表示更新 ====== */
function updateCart(){
  const list  = document.getElementById('cartlist');
  const badge = document.getElementById('cartBadge');

  list.innerHTML = '';

  if (!cart.length){
    list.textContent = 'カートは空です';
    document.getElementById('subtotal').textContent = '0円';
    document.getElementById('total').textContent    = '0円';
    if (badge){
      badge.textContent = '0';
      badge.classList.add('is-empty');
    }
    return;
  }

  let subtotal = 0;
  cart.forEach((it,i)=>{
    subtotal += it.price * it.qty;
    list.insertAdjacentHTML("beforeend", `
      <div class='cartitem'>
        <div>${it.name}</div>
        <div>${it.qty}</div>
        <div>${(it.price * it.qty).toLocaleString()}円</div>
        <button onclick='removeItem(${i})'
                style='color:red;border:none;background:none;font-weight:800'>×</button>
      </div>
    `);
  });

  document.getElementById('subtotal').textContent = subtotal.toLocaleString() + '円';
  document.getElementById('total').textContent    = Math.round(subtotal * 1.1).toLocaleString() + '円';

  if (badge){
    const totalQty = cart.reduce((sum, it) => sum + it.qty, 0);
    if (totalQty > 0){
      badge.textContent = totalQty;
      badge.classList.remove('is-empty');
    }else{
      badge.textContent = '0';
      badge.classList.add('is-empty');
    }
  }
}

function removeItem(i){
  cart.splice(i,1);
  updateCart();
}

/* ====== 商品描画 ====== */
async function boot(){
  const PRODUCTS = await fetch('products.json', { cache: "no-store" })
    .then(r => { if (!r.ok) throw new Error("products.jsonが読み込めませんでした"); return r.json(); })
    .catch(err => {
      console.error(err);
      alert("⚠️ 商品データの読み込みに失敗しました。products.jsonの配置を確認してください。");
      return [];
    });

  const grid = document.getElementById('grid');
  grid.innerHTML = ""; // クリア

  PRODUCTS.forEach(p => {
    const jan   = String(p.jan ?? "");
    const name  = String(p.name ?? "");
    const price = Number(p.price ?? 0);
    const barcode = renderBarcode(jan) || "";

    grid.insertAdjacentHTML("beforeend", `
      <div class="card">
        <div class="thumb">
          <img src="img/${jan}.jpg" onerror="this.onerror=null;this.src='img/noimage.jpg'">
        </div>

        <div class="body">
          <div class="title">${name}</div>
          <div class="price-row">
            <span class="price-main">￥${Math.round(price * 1.1).toLocaleString()}</span>
            <span class="price-sub">（税抜 ￥${price.toLocaleString()}）</span>
          </div>
          <div class="barcode">${barcode}</div>
        </div>

        <!-- 印刷専用数量欄（通常は非表示。@media print で表示） -->
        <div class="qty-print print-only" style="display:none">
          <label style="margin-right:4px;">数量</label>
          <input id="print-qty-${jan}" type="text" inputmode="numeric" pattern="[0-9０-９]*" aria-label="印刷用数量">
        </div>

        <div class="actions-card">
          <input id="qty-${jan}" type="number" class="qtyinput" min="0" step="1" placeholder="数量">
          <button class="btn" type="button"
            onclick='addToCart(${JSON.stringify({ jan, name, price })})'>
            カートに追加
          </button>
        </div>
      </div>
    `);
  });
}

/* ====== カート操作 ====== */
function addToCart(p){
  const q = document.getElementById(`qty-${p.jan}`).value;
  if (!q || q <= 0) return;

  const ex = cart.find(x => x.jan === p.jan);
  if (ex){
    ex.qty += Number(q);
  }else{
    cart.push({...p, qty:Number(q)});
  }
  updateCart();
  document.getElementById(`qty-${p.jan}`).value = '';
}

/* ====== 送信 ====== */
async function sendOrder(){
  if(!cart.length){ alert('カートが空です'); return; }
  const buyer = (document.getElementById('buyerName')?.value || "").trim();
  if(!buyer){ alert('発注者名を入力してください'); return; }
  const partner = (document.getElementById('partnerName')?.value || "").trim();
  const site    = (document.getElementById('siteName')?.value || "").trim();

  const payload = {
    buyerName:buyer,
    partnerName:partner,
    siteName:site,
    items:cart.map(c=>({jan:c.jan,name:c.name,price:c.price,qty:c.qty}))
  };

  const btn = document.getElementById('orderBtn');
  btn.disabled = true;
  btn.textContent = '送信中…';

  try{
    await fetch(GAS_ENDPOINT,{
      method:'POST',
      mode:'no-cors',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(payload)
    });

    alert('✅ 発注を受け付けました（メール送信済み）');

    cart = [];
    updateCart();

    // TOPに戻す
    const topPage = document.getElementById('topPage');
    const mainEl  = document.querySelector('main');
    if (topPage && mainEl){
      mainEl.style.display = 'none';
      mainEl.style.opacity = '0';
      mainEl.style.visibility = 'hidden';
      mainEl.style.zIndex = '0';

      topPage.style.display = 'flex';
      topPage.style.opacity = '1';
      topPage.style.visibility = 'visible';
      topPage.style.zIndex = '9999';

      ['buyerName','partnerName','siteName'].forEach(id=>{
        const el = document.getElementById(id);
        if (el) el.value = '';
      });
    }
  }catch(e){
    alert('⚠️ 送信に失敗しました：'+e.message);
  }finally{
    btn.disabled = false;
    btn.textContent = 'この内容で発注（メール送信）';
  }
}

/* ====== バーコード ====== */
function ean13Pattern(d){
  const L=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],
        G=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],
        R=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],
        P={"0":"LLLLLL","1":"LLGLGG","2":"LLGGLG","3":"LLGGGL","4":"LGLLGG","5":"LGGLLG","6":"LGGGLL","7":"LGLGLG","8":"LGLGGL","9":"LGGLGL"};
  const s=(d||"").replace(/[^0-9]/g,"");
  if(s.length<12) return null;
  const d12=s.slice(0,12),
        cd=(10-((d12.split("").reduce((a,b,i)=>a+Number(b)*(i%2?3:1),0))%10))%10;
  const first=d12[0], left=d12.slice(1,7), right=d12.slice(7,12)+cd;
  let bits="101", par=P[first];
  for(let i=0;i<6;i++){ bits+=(par[i]==="L"?L[left[i]]:G[left[i]]); }
  bits+="01010";
  for(let i=0;i<6;i++){ bits+=R[right[i]]; }
  return bits+"101";
}

function renderBarcode(jan){
  const bits=ean13Pattern(jan);
  if(!bits) return "";
  let out=`<svg viewBox='0 0 ${bits.length} 20' xmlns='http://www.w3.org/2000/svg' shape-rendering='crispEdges'><rect width='${bits.length}' height='20' fill='#fff'/>`;
  for(let i=0;i<bits.length;i++) if(bits[i]==="1") out+=`<rect x='${i}' y='0' width='1' height='18' fill='#000'/>`;
  out+="</svg>";
  return out;
}
</script>


</body>
</html>


