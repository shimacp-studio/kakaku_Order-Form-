<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã‚·ãƒã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ç™ºæ³¨ã‚«ã‚¿ãƒ­ã‚°</title>
<style>
:root{
  --ink:#0f172a;--muted:#64748b;--line:#e5e7eb;
  --bg:#f6f8ff;--card:#fff;--brand:#1e66ff;
  --accent:#155eef;--shadow:0 4px 16px rgba(16,24,40,.06);
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);
font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
h1{margin:0;font-size:clamp(18px,3.4vw,26px);font-weight:800}
.hidden{display:none!important;}

/* ====== é€šå¸¸ãƒ‡ã‚¶ã‚¤ãƒ³ ====== */
header {
  position: sticky;
  top: 0;
  z-index: 30;
  background: #ffffffcc;
  border-bottom: 1px solid #e2e8f0; /* â†ã“ã¡ã‚‰ã®è‰²æŒ‡å®šã«çµ±ä¸€ã§OK */
  backdrop-filter: saturate(140%) blur(6px);
}

.wrap {
  max-width: 1200px;
  margin: 0 auto;
  padding: 10px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}
.brand {
  display: flex;
  align-items: center;
  gap: 10px;
}
.brand img { height: 38px; width: auto; }
.actions {
  display: flex;
  gap: 12px;
  align-items: center;
}
.btn {
  background: var(--brand);
  color: #fff;
  border: 1px solid #1243c1;
  border-radius: 10px;
  padding: 8px 14px;
  font-weight: 700;
  cursor: pointer;
  font-size: 13px;
  transition: 0.3s;
}
.btn:disabled { opacity: .5; cursor: not-allowed; }

/* === ãƒ˜ãƒƒãƒ€ãƒ¼2æ®µæ§‹æˆ === */
.header-2rows {
  flex-direction: column;
  align-items: flex-start;
  gap: 6px;
}

.search-inline {
  display: flex;
  gap: 8px;
  margin-top: 6px;
}
.search-inline .input {
  border: 1px solid #cbd5e1;
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 14px;
}
.search-inline select {
  background: linear-gradient(180deg, #f8fafc, #f1f5f9);
  cursor: pointer;
}

/* ãƒ­ã‚´ã¨ã‚¿ã‚¤ãƒˆãƒ« */
.title-group {
  display: flex;
  flex-direction: column;
  justify-content: center;
}

  .title-group h1 {
    font-size: 18px;
    font-weight: 800;
    color: #1e293b;
    margin: 0;
  }
  .buyer-name-display {
    font-size: 13px;
    color: #475569;
    margin: 2px 0 0 0;
  }

  /* å³å´æ¤œç´¢ãƒ»æ“ä½œã‚¨ãƒªã‚¢ */
  .search-actions {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .search-actions .input {
    border: 1px solid #cbd5e1;
    border-radius: 10px;
    padding: 8px 12px;
    font-size: 14px;
  }
  .search-actions select {
    background: linear-gradient(180deg, #f8fafc, #f1f5f9);
    cursor: pointer;
  }

  /* ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ */
  .cart-icon {
    position: relative;
    display: inline-block;
    cursor: pointer;
  }
  .cart-icon img {
    width: 38px;
    height: auto;
  }
  .cart-badge {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #ef4444;
    color: #fff;
    font-size: 11px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 9999px;
    min-width: 18px;
    text-align: center;
    display: none;
  }
  /* ã“ã“ â†‘ ã¾ã§ã‚’è¿½åŠ  */

  
.controls{max-width:1200px;margin:10px auto;display:grid;gap:8px;
padding:0 16px;grid-template-columns:repeat(3,1fr);}
.input{background:#fff;border:1px solid var(--line);
border-radius:8px;padding:8px 10px;font-size:14px;}

  /* === æ¤œç´¢ãƒãƒ¼ === */
.controls-search {
  max-width: 1200px;
  margin: 12px auto;
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
}
.controls-search .input {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 10px 14px;
  font-size: 15px;
  background: #fff;
  transition: all 0.2s ease;
}
.controls-search .input:focus {
  outline: none;
  box-shadow: 0 0 0 3px #93c5fd;
  border-color: #2563eb;
}
#searchInput {
  flex: 1;
}
#categorySelect {
  width: 260px;
  cursor: pointer;
  background: linear-gradient(180deg, #f8fafc, #f1f5f9);
}

/* === å•†å“3åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå›ºå®šï¼ˆç¾ã—ã„ã‚«ãƒ¼ãƒ‰é–“éš”ï¼‰ === */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(310px, 1fr)) !important;
  gap: 24px;
  margin: 24px auto;
  max-width: 1280px;
  padding: 0 16px;
}

/* === å•†å“ã‚«ãƒ¼ãƒ‰ï¼ˆAmazonï¼‹Appleé¢¨ï¼‰ === */
.card {
  background: #fff;
  border-radius: 16px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  overflow: hidden;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
}
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 24px rgba(37,99,235,0.15);
}
.thumb {
  background: linear-gradient(180deg, #f9fafb, #f3f4f6);
  height: 210px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.thumb img {
  max-width: 90%;
  max-height: 180px;
  object-fit: contain;
  transition: transform 0.25s ease;
}
.card:hover .thumb img {
  transform: scale(1.07);
}
.body {
  padding: 14px 16px 18px;
  display: grid;
  gap: 8px;
}
.title {
  font-weight: 700;
  font-size: 15px;
  color: #1e293b;
  line-height: 1.4;
  min-height: 42px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.price {
  font-size: 16px;
  font-weight: 800;
  color: #2563eb;
}
.actions-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 16px 14px;
  background: #f8fafc;
  border-top: 1px solid #e2e8f0;
}
.qtyinput {
  border: 1px solid #cbd5e1;
  border-radius: 10px;
  padding: 6px;
  width: 70px;
  font-size: 14px;
}
.actions-card .btn {
  background: linear-gradient(135deg, #2563eb, #1e40af);
  border: none;
  color: #fff;
  font-weight: 700;
  padding: 8px 14px;
  border-radius: 10px;
  box-shadow: 0 3px 6px rgba(37,99,235,0.2);
  transition: all 0.2s ease;
}
.actions-card .btn:hover {
  background: linear-gradient(135deg, #1d4ed8, #1e3a8a);
  transform: translateY(-2px);
}


main{display:grid;grid-template-columns:1fr 340px;gap:16px;
max-width:1200px;margin:14px auto;padding:0 16px}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.card{position:relative;background:var(--card);border:1px solid #d6e0ff;
border-radius:14px;overflow:hidden;display:flex;flex-direction:column;
box-shadow:var(--shadow);padding-bottom:10px}
.thumb{aspect-ratio:3/2;display:flex;align-items:center;
justify-content:center;border-bottom:1px solid var(--line);background:#fff}
.thumb img{max-width:92%;max-height:92%;object-fit:contain}
.body{padding:10px 12px;display:grid;gap:6px}
.title{font-weight:700;font-size:12px;line-height:1.35;
display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;
overflow:hidden;min-height:2.6em}
.barcode svg{height:18px;width:80px;}
.price{font-weight:800;font-size:13px}
.actions-card{display:flex;align-items:center;
justify-content:space-between;margin-top:auto;padding:0 10px}
.qtyinput{width:70px;text-align:center;border:1px solid var(--line);
border-radius:8px;padding:4px}
.cart{position:sticky;top:84px;height:calc(100dvh - 100px);
background:#fff;border:1px solid var(--line);border-radius:14px;
padding:12px;display:flex;flex-direction:column;gap:8px;box-shadow:var(--shadow)}
.cartlist{flex:1;overflow:auto;border-top:1px dashed var(--line);padding-top:8px}
.cartitem{display:grid;grid-template-columns:1fr 62px 70px 24px;
gap:6px;align-items:center;padding:6px 0;border-bottom:1px dashed #e5e7eb}

/* ====== å°åˆ·è¨­å®š ====== */

  /* ==== å°åˆ·å°‚ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’é€šå¸¸æ™‚ã¯éè¡¨ç¤º ==== */
.header-print {
  display: none;
}
/* ==== ãƒ•ãƒƒã‚¿ãƒ¼ã‚’é€šå¸¸æ™‚ã¯éè¡¨ç¤ºã« ==== */
.footer-print {
  display: none;
}

/* === å°åˆ·ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆçµ±åˆæ¸ˆï¼‰ === */
@page {
  size: A4 portrait;
  margin: 8mm 8mm 18mm 8mm;
}

@media print {
  /* å°åˆ·æ™‚ã«éè¡¨ç¤ºã«ã™ã‚‹è¦ç´  */
  header, .actions, .cart, .actions-card, .controls, .search-actions {
    display: none !important;
  }

  body {
    background: #fff;
    counter-reset: item;
    position: relative !important;
  }

  main {
    display: block;
    margin: 0;
    padding: 0;
    position: relative !important;
    min-height: 245mm !important;
  }

  /* === 2åˆ—ã‚°ãƒªãƒƒãƒ‰ === */
  .grid {
    display: grid !important;
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 6mm !important;
    width: calc(210mm - 20mm);
    margin: 30mm auto 0 !important;
  }

  /* === å•†å“ã‚«ãƒ¼ãƒ‰ === */
  .card {
    position: relative !important;
    display: flex !important;
    flex-direction: row !important;
    align-items: flex-start !important;
    gap: 4mm !important;
    border: 1px solid #d9e1f2 !important;
    background: #fff !important;
    border-radius: 8px !important;
    box-shadow: none !important;
    padding: 3.5mm !important;
    height: calc((297mm - 95mm) / 5) !important;
    page-break-inside: avoid !important;
    overflow: hidden !important;
  }

  /* === å•†å“ç”»åƒ === */
  .thumb {
    flex: 0 0 33mm !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border: none !important;
  }

  .thumb img {
    max-height: 27mm !important;
    max-width: 100% !important;
    object-fit: contain !important;
  }

  /* === å•†å“æƒ…å ± === */
  .body {
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: flex-start !important;
    gap: 2mm !important;
    padding-right: 3mm !important;
  }

  .title {
    font-size: 9.5pt !important;
    font-weight: 700 !important;
    line-height: 1.4 !important;
    color: #111 !important;
    max-height: 22mm !important;
  }

  .barcode svg {
    height: 20px !important;
    width: 70px !important;
  }

  .price {
    font-size: 9pt !important;
    color: #2563eb !important;
    font-weight: 700 !important;
  }

  /* === ç•ªå·ã‚¿ã‚° === */
  .card::before {
    counter-increment: item;
    content: "No." counter(item);
    position: absolute;
    bottom: 1.8mm;
    right: 2.2mm;
    padding: 1.4mm 3mm;
    font-family: "Orbitron", "Segoe UI", "Noto Sans JP", sans-serif;
    font-weight: 700;
    font-size: 7.3pt;
    color: #fff;
    background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 50%, #1e3a8a 100%);
    border-radius: 12px;
  }

  /* === å°åˆ·ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ === */
  .header-print {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
    position: fixed !important;
    top: 5mm !important;
    left: 0;
    width: 100%;
    background: #fff !important;
    z-index: 9999 !important;
  }

  .header-print img {
    height: 14mm !important;
    width: auto !important;
  }

  .header-print h2 {
    font-size: 16pt !important;
    font-weight: 800 !important;
    margin: 0 !important;
  }

  .footer-print {
    display: block !important;
    position: fixed !important;
    bottom: 0mm !important;
    left: 0;
    width: 100%;
    text-align: center;
    font-size: 11pt !important;
    font-family: "Noto Sans JP", "Segoe UI", sans-serif;
    color: #0f172a !important;
    background: #fff !important;
    z-index: 9999 !important;
  }
}

/* === é€šå¸¸ç”»é¢ï¼š3åˆ—å›ºå®š === */
@media screen {
  .grid {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 24px !important;
    max-width: 1200px !important;
    margin: 24px auto !important;
    padding: 0 16px !important;
  }
}





/* ==== å¸¸ã«æœ€å‰é¢ã«å‡ºã™è¦ç´  ==== */
main, .grid, .card {
  position: relative !important;
  z-index: 1 !important;
}


}


  
</style>
</head>

<body>

<!-- === TOPç”»é¢ === -->
<section id="top-section" style="text-align:center; padding:80px 20px;">
  <div style="background:#fff; display:inline-block; padding:40px 60px; border-radius:16px; box-shadow:0 4px 20px rgba(0,0,0,0.08);">
    <img src="img/shima_owl.jpg" alt="logo" style="width:80px; height:auto; margin-bottom:10px;">
    <h1>ã‚·ãƒã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ç™ºæ³¨ã‚«ã‚¿ãƒ­ã‚°</h1>
    <p style="color:#475569; font-size:14px; margin-bottom:20px;">ç™ºæ³¨è€…åã‚’å…¥åŠ›ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„</p>

    <div style="display:flex; flex-direction:column; gap:12px; max-width:320px; margin:auto;">
      <input id="buyerName" class="input" placeholder="ç™ºæ³¨è€…åï¼ˆå¿…é ˆï¼‰" required>
      <input id="partnerName" class="input" placeholder="ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ä¼æ¥­ï¼ˆä»»æ„ï¼‰">
      <input id="siteName" class="input" placeholder="ç¾å ´åï¼ˆä»»æ„ï¼‰">

      <!-- âœ… ãƒœã‚¿ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
      <div style="
        display:flex;
        justify-content:center;
        align-items:flex-start;
        gap:12px;
        margin-top:20px;">
        
        <!-- å·¦ï¼šç™ºæ³¨ãƒœã‚¿ãƒ³ -->
        <button id="startBtn" class="btn"
          style="background:#2563eb; border:1px solid #1e40af; height:42px;">
          ç™ºæ³¨ã‚«ã‚¿ãƒ­ã‚°ã¸é€²ã‚€
        </button>

        <!-- å³ï¼šä¸Šä¸‹2æ®µã®ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
        <div style="display:flex; flex-direction:column; gap:8px;">
          <button id="resetBtn" class="btn"
            style="background:#f1f5f9; color:#0f172a; border:1px solid #cbd5e1; height:42px;">
            å…¥åŠ›ãƒªã‚»ãƒƒãƒˆ
          </button>
          <button id="clearHistoryBtn" class="btn"
            style="background:#fee2e2; color:#991b1b; border:1px solid #fecaca; height:38px;">
            å±¥æ­´ãƒªã‚»ãƒƒãƒˆ
          </button>
        </div>
      </div>
    </div>
  </div>
</section>



    </div>
  </div>
</section>

<!-- === ç™ºæ³¨ç”»é¢ === -->
<main id="order-section" class="hidden">

  <header>
  <div class="wrap header-2rows">
    <!-- å·¦å´ï¼šãƒ­ã‚´ã¨ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="brand">
      <img src="img/shima_owl.jpg" alt="logo">
      <div class="title-group">
        <h1>ã‚·ãƒã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ç™ºæ³¨ã‚«ã‚¿ãƒ­ã‚°</h1>
        <p id="buyerNameDisplay" class="buyer-name-display"></p>

        <!-- ğŸ” ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸‹ã«æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ -->
        <div class="search-inline">
          <input id="searchInput" class="input" placeholder="å•†å“åã‚„JANã‚³ãƒ¼ãƒ‰ã§æ¤œç´¢">
          <select id="categorySelect" class="input">
            <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
          </select>
        </div>
      </div>
    </div>

    <!-- å³å´ï¼šå°åˆ·ãƒ»ã‚«ãƒ¼ãƒˆ -->
    <div class="actions">
      <button class="btn" onclick="window.print()">å°åˆ·ï¼ˆA4ç¸¦ï¼‰</button>
      <div id="cartIcon" class="cart-icon" title="ã‚«ãƒ¼ãƒˆã‚’è¦‹ã‚‹">
        <img src="img/KART.png" alt="ã‚«ãƒ¼ãƒˆ">
        <span id="cartBadge" class="cart-badge"></span>
      </div>
    </div>
  </div>
</header>


  <!-- âœ… ã“ã“ã‹ã‚‰ä¸‹ã ã‘æ®‹ã™ -->
  <section>
    <div id="grid" class="grid"></div>
  </section>

  <aside class="cart">
    <h2>ã‚«ãƒ¼ãƒˆ</h2>
    <div id="cartlist" class="cartlist"></div>
    <div>
      <strong>å°è¨ˆï¼š</strong><span id="subtotal">0å††</span><br>
      <strong>ç¨è¾¼ï¼š</strong><span id="total">0å††</span>
    </div>
    <button id="orderBtn" class="btn">ã“ã®å†…å®¹ã§ç™ºæ³¨ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰</button>
  </aside>
</main>


  <!-- âœ… ã“ã“ã«è¿½åŠ ã—ã¾ã™ -->
<div class="header-print">
  <img src="img/shima_owl.jpg" alt="logo">
  <h2>ã‚·ãƒã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ç™ºæ³¨ã‚«ã‚¿ãƒ­ã‚°</h2>
</div>


<div class="footer-print">
  ç™ºæ³¨è€…åï¼šï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ã€€æ—¥ä»˜ï¼šï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ã€€å‚™è€ƒï¼šï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿
</div>

<script>
// === TOPç”»é¢ â†’ ç™ºæ³¨ç”»é¢ åˆ‡ã‚Šæ›¿ãˆåˆ¶å¾¡ ===
document.getElementById("startBtn").addEventListener("click", () => {
  const buyer = document.getElementById("buyerName").value.trim();
  const partner = document.getElementById("partnerName").value.trim();
  const site = document.getElementById("siteName").value.trim();
  if (!buyer) return alert("ç™ºæ³¨è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  // âœ… buyerNameDisplay ã¯ <p>ã‚¿ã‚°ç”¨
  document.getElementById("buyerNameDisplay").textContent = "ç™ºæ³¨è€…åï¼š" + buyer;

  // âœ… partner / site ã¯ä»Šå›ã¯ç™ºæ³¨ç”»é¢ã«å‡ºã•ãªã„ã®ã§å‰Šé™¤ï¼ˆä¸è¦ï¼‰
  // document.getElementById("partnerNameDisplay").value = partner ? "ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ä¼æ¥­ï¼š" + partner : "";
  // document.getElementById("siteNameDisplay").value = site ? "ç¾å ´åï¼š" + site : "";

  // âœ… ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
  document.getElementById("top-section").classList.add("hidden");
  document.getElementById("order-section").classList.remove("hidden");

  boot();
});

document.getElementById("resetBtn").addEventListener("click", () => {
  document.getElementById("buyerName").value = "";
  document.getElementById("partnerName").value = "";
  document.getElementById("siteName").value = "";
});
</script>

<script>
const GAS_ENDPOINT="https://script.google.com/macros/s/AKfycbxGz8VCT8IkE_8nPOX7vVh-CMGkpOVPsnIhbO-FEViWKcP6KAapatDeusREagPta62kuA/exec";
let cart=[];
function updateCart(){
  const list=document.getElementById('cartlist');
  list.innerHTML='';
  if(!cart.length){
    list.textContent='ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™';
    document.getElementById('subtotal').textContent='0å††';
    document.getElementById('total').textContent='0å††';
    updateCartBadge(); // â† ç©ºã®ã¨ãã‚‚ãƒãƒƒã‚¸æ›´æ–°
    return;
  }
  let subtotal=0;
  cart.forEach((it,i)=>{
    subtotal+=it.price*it.qty;
    list.innerHTML+=`
      <div class='cartitem'>
        <div>${it.name}</div>
        <div>${it.qty}</div>
        <div>${(it.price*it.qty).toLocaleString()}å††</div>
        <button onclick='removeItem(${i})' style='color:red;border:none;background:none;font-weight:800'>Ã—</button>
      </div>`;
  });
  document.getElementById('subtotal').textContent=subtotal.toLocaleString()+"å††";
  document.getElementById('total').textContent=Math.round(subtotal*1.1).toLocaleString()+"å††";

  updateCartBadge(); // âœ… â† ã“ã®è¡Œã‚’æœ«å°¾ã«è¿½åŠ 
}

function removeItem(i){
  cart.splice(i,1);
  updateCart();
}

// === ã‚«ãƒ¼ãƒˆãƒãƒƒã‚¸æ›´æ–° ===
function updateCartBadge() {
  const badge = document.getElementById("cartBadge");
  if (cart.length > 0) {
    badge.textContent = cart.length;
    badge.style.display = "inline-block";
  } else {
    badge.style.display = "none";
  }
}
let PRODUCTS_ALL = [];

/** ====== åˆæœŸãƒ­ãƒ¼ãƒ‰ ====== **/
async function boot() {
  PRODUCTS_ALL = await fetch('./products.json').then(r => r.json());

  // âœ… ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ã‚’å‹•çš„ã«ç”Ÿæˆ
  const categorySet = [...new Set(PRODUCTS_ALL.map(p => p.category).filter(Boolean))];
  const categorySelect = document.getElementById('categorySelect');
  categorySelect.innerHTML = `<option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼</option>` +
    categorySet.map(c => `<option value="${c}">${c}</option>`).join('');

  // åˆå›è¡¨ç¤º
  renderProducts(PRODUCTS_ALL);

  // ğŸ” æ¤œç´¢ï¼†ã‚«ãƒ†ã‚´ãƒªçµã‚Šè¾¼ã¿ã‚¤ãƒ™ãƒ³ãƒˆ
  document.getElementById('searchInput').addEventListener('input', filterProducts);
  categorySelect.addEventListener('change', filterProducts);
}

/** ====== æ¤œç´¢ãƒ»ã‚«ãƒ†ã‚´ãƒªçµã‚Šè¾¼ã¿ ====== **/
function filterProducts() {
  const keyword = document.getElementById('searchInput').value.trim();
  const category = document.getElementById('categorySelect').value;

  const filtered = PRODUCTS_ALL.filter(p => {
    const matchKeyword =
      !keyword || p.name.includes(keyword) || p.jan.includes(keyword);
    const matchCategory =
      !category || p.category === category;
    return matchKeyword && matchCategory;
  });

  renderProducts(filtered);
}

/** ====== å•†å“ã‚«ãƒ¼ãƒ‰æç”» ====== **/
function renderProducts(list) {
  const grid = document.getElementById('grid');
  grid.innerHTML = "";

  list.forEach(p => {
    const barcode = renderBarcode(p.jan);
    grid.innerHTML += `
      <div class='card'>
        <div class='thumb'>
          <img src='img/${p.jan}.jpg' onerror="this.src='img/noimage.jpg'">
        </div>
        <div class='body'>
          <div class='title'>${p.name}</div>
          <div class='barcode'>${barcode}</div>
          <div class='price'>ç¨æŠœï¼š${p.price.toLocaleString()}å††</div>
          <div class='price'>ç¨è¾¼ï¼š${Math.round(p.price * 1.1).toLocaleString()}å††</div>
        </div>
        <div class='actions-card'>
          <select id='qty-${p.jan}' class='qtyinput'>
            ${Array.from({ length: 20 }, (_, i) =>
              `<option value="${i + 1}">${i + 1}</option>`
            ).join('')}
          </select>
          <button class='btn' onclick='addToCart(${JSON.stringify(p)})'>
            ã‚«ãƒ¼ãƒˆã«è¿½åŠ 
          </button>
        </div>
      </div>`;
  });
}



function addToCart(p){const q=document.getElementById(`qty-${p.jan}`).value;if(!q||q<=0)return;const ex=cart.find(x=>x.jan===p.jan);if(ex){ex.qty+=Number(q);}else{cart.push({...p,qty:Number(q)});}updateCart();document.getElementById(`qty-${p.jan}`).value='';}
async function sendOrder() {
  if (!cart.length) return alert('ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™');

  const buyer = document.getElementById('buyerName').value.trim();
  if (!buyer) return alert('ç™ºæ³¨è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

  const partner = document.getElementById('partnerName').value.trim();
  const site = document.getElementById('siteName').value.trim();

  const payload = {
    buyerName: buyer,
    partnerName: partner,
    siteName: site,
    items: cart.map(c => ({
      jan: c.jan,
      name: c.name,
      price: c.price,
      qty: c.qty
    }))
  };

  const btn = document.getElementById('orderBtn');
  btn.disabled = true;
  btn.textContent = 'é€ä¿¡ä¸­â€¦';

  try {
    await fetch(GAS_ENDPOINT, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    alert('âœ… ç™ºæ³¨ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡æ¸ˆã¿ï¼‰');

    // === ã‚«ãƒ¼ãƒˆåˆæœŸåŒ– ===
    cart = [];
    updateCart();

    // === TOPç”»é¢ã«æˆ»ã™ ===
    document.getElementById('order-section').classList.add('hidden');
    document.getElementById('top-section').classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });

  } catch (e) {
    alert('âš ï¸ é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸï¼š' + e.message);
  } finally {
    btn.disabled = false;
    btn.textContent = 'ã“ã®å†…å®¹ã§ç™ºæ³¨ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰';
  }
}

document.getElementById('orderBtn').onclick = sendOrder;


function ean13Pattern(d){const L=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],G=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],R=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],P={"0":"LLLLLL","1":"LLGLGG","2":"LLGGLG","3":"LLGGGL","4":"LGLLGG","5":"LGGLLG","6":"LGGGLL","7":"LGLGLG","8":"LGLGGL","9":"LGGLGL"};const s=(d||"").replace(/[^0-9]/g,"");if(s.length<12)return null;const d12=s.slice(0,12),cd=(10-((d12.split("").reduce((a,b,i)=>a+Number(b)*(i%2?3:1),0))%10))%10;const first=d12[0],left=d12.slice(1,7),right=d12.slice(7,12)+cd;let bits="101",par=P[first];for(let i=0;i<6;i++){bits+=(par[i]==="L"?L[left[i]]:G[left[i]]);}bits+="01010";for(let i=0;i<6;i++){bits+=R[right[i]];}return bits+"101";}
function renderBarcode(jan){const bits=ean13Pattern(jan);if(!bits)return"";let out=`<svg viewBox='0 0 ${bits.length} 20' xmlns='http://www.w3.org/2000/svg' shape-rendering='crispEdges'><rect width='${bits.length}' height='20' fill='#fff'/>`;for(let i=0;i<bits.length;i++)if(bits[i]==="1")out+=`<rect x='${i}' y='0' width='1' height='18' fill='#000'/>`;out+="</svg>";return out;}

 /* === ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆæ©Ÿèƒ½ === */
function setupAutocomplete(id, key) {

  const input = document.getElementById(id);
  let history = JSON.parse(localStorage.getItem(key) || "[]");

  // ğŸ”¹ datalist è¦ç´ ã‚’ç”Ÿæˆ
  const datalist = document.createElement("datalist");
  datalist.id = id + "-list";
  document.body.appendChild(datalist);
  input.setAttribute("list", datalist.id);

  function updateList() {
    datalist.innerHTML = history.map(item => `<option value="${item}">`).join("");
  }
  updateList();

  // ğŸ”¹ å…¥åŠ›ç¢ºå®šæ™‚ã«å±¥æ­´ã¸ä¿å­˜
  input.addEventListener("change", () => {
    const value = input.value.trim();
    if (value && !history.includes(value)) {
      history.unshift(value);
      if (history.length > 10) history = history.slice(0, 10); // ä¸Šé™10ä»¶
      localStorage.setItem(key, JSON.stringify(history));
      updateList();
    }
  });

  // ğŸ”¹ ãƒªã‚»ãƒƒãƒˆæ™‚ã«å±¥æ­´å‰Šé™¤
  document.getElementById("resetBtn").addEventListener("click", () => {
    localStorage.removeItem(key);
    history = [];
    updateList();
  });
}

// ===== å„å…¥åŠ›æ¬„ã«é©ç”¨ =====
window.addEventListener("DOMContentLoaded", () => {
  setupAutocomplete("buyerName", "history_buyerName");
  setupAutocomplete("partnerName", "history_partnerName");
  setupAutocomplete("siteName", "history_siteName");

  // ğŸ”¹ å…¥åŠ›ãƒªã‚»ãƒƒãƒˆï¼ˆæ—¢å­˜ãƒœã‚¿ãƒ³ï¼‰
  document.getElementById("resetBtn").addEventListener("click", () => {
    document.getElementById("buyerName").value = "";
    document.getElementById("partnerName").value = "";
    document.getElementById("siteName").value = "";
  });

  // ğŸ”¹ å±¥æ­´ãƒªã‚»ãƒƒãƒˆï¼ˆæ–°ãƒœã‚¿ãƒ³ï¼‰
  document.getElementById("clearHistoryBtn").addEventListener("click", () => {
    localStorage.removeItem("history_buyerName");
    localStorage.removeItem("history_partnerName");
    localStorage.removeItem("history_siteName");
    alert("âœ… å…¥åŠ›å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã—ãŸã€‚");
  });
});

  
</script>
</body>
</html>
